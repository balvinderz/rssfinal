<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

</head>
<body>
<nav class="navbar navbar-light bg-primary">
    <a class="navbar-brand text-white" href="#">
        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/4/43/Feed-icon.svg/1200px-Feed-icon.svg.png" width="30" height="30" class="d-inline-block align-top " alt="" loading="lazy">
        Settings Page
    </a>
</nav>
<div class="container-fluid">
    <div class="row mt-2">
        <div class="col-12">

            <p class="">Scraper Status :  <span th:class="${running.equals('Running')? 'text-success' : 'text-danger'}" class="text-success" th:text="${running}"></span></p>

        </div>
    </div>
    <form th:action="${running.equals('Running') ? './stopScraper' : './startScraper'}" method="GET">
        <button type="submit" class="btn btn-primary" th:text="${running.equals('Running') ?'Stop Server' : 'Start server'}">

        </button>
    </form>
    <div class="row mt-1">
        <div class="col-12">
            <p>Current Configuration </p>
        </div>

    </div>
    <div class="row">
        <div class="col-12">
            <form action="#" th:action="@{/saveConfig}" >
                <div class="form-group">
                    <label for="rssLink">Rss Link</label>
                    <input class="form-control" name="rssLink" id="rssLink" type="link" th:value="${rssLink}"  >
                </div>
                <div class="form-group">
                    <label for="cookie">Cookie</label>
                    <input type="cookie" name="cookie" class="form-control" id="cookie" th:value="${cookie}">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <br/>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="jobTypes[]" id="inlineRadio1" value="Pro" th:checked="${Pro}" >
                        <label class="form-check-label" for="inlineRadio1">Pro</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkBox" name="jobTypes[]" id="inlineRadio2" value="Standard" th:checked="${Standard}" >
                        <label class="form-check-label" for="inlineRadio2">Standard</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="jobTypes[]" id="inlineRadio3" value="Edit" th:checked="${Edit}" >
                        <label class="form-check-label" for="inlineRadio3">Edit</label>

                    </div>
                </div>

                <div class="form-group">
                    <label for="min">Minimum Value</label>
                    <input class="form-control" id="min" type="number" name="minimum" th:value="${minimum}"  >
                </div>
                <div class="form-group">
                    <label for="max">Maximum Value</label>
                    <input class="form-control" id="max" type="number" name="maximum" th:value="${maximum}"  >
                </div>
                <button type="button" onclick="buttonOnClick()" class="btn btn-primary">Save</button>
            </form>
        </div>

    </div>
</div>
</body>
<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script>
   async  function buttonOnClick() {
        let rssLink = $("#rssLink").val();
        let cookie = $("#cookie").val();
        let minimum = $("#min").val()
        let maximum = $("#max").val();
       var sports = document.forms[1].elements[ 'jobTypes[]' ];
       var jobString ="";

       for(let i =0;i<sports.length;i++)
       {
           if(sports[i].checked ===true)
               jobString+=sports[i].value+",";

       }

       if(jobString==="")
           jobString="Pro,Standard,Edit";
       else
           jobString=jobString.substring(0,jobString.length-1);


        let jobType = $("input:radio[name ='jobType']:checked").val();
        let  res = await fetch(`./saveConfig?rssLink=${rssLink}&cookie=${cookie}&minimum=${minimum}&maximum=${maximum}&jobType=${jobString}`);
        let text = await res.text();
        alert(text);
        location.reload();

    }
</script>

</html>